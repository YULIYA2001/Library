<div class="container my-4 pt-4" id="main-container">

  <div class="d-flex justify-content-center" style="width: 100%">
    <form class="form-inline my-2 my-lg-0 mr-sm-2">
      <input type="search" ngModel (ngModelChange)="searchBooks(key.value)" #key="ngModel"
             name="key" id="searchName" class="form-control mr-sm-2" placeholder="Поиск..." required>
    </form>
  </div>

  <div class="row">
    <div class="col-md-8">
      <div class="section-title text-center text-md-start">
        <h3 class="title mb-4">Книги</h3>
      </div>
    </div><!--end col-->

    <div class="col-md-4 mt-4 mt-sm-0 d-md-block">
      <div class="text-right text-md-end">
        <a (click)="onOpenModal(null, 'add')" class="btn text-primary ml-0 mr-auto">Новая</a>
      </div>
    </div><!--end col-->
  </div><!--end row-->

  <div class="row">
    <div *ngFor="let book of books" class="col-lg-4 col-md-6 col-12 mt-4 pt-2 d-flex align-items-stretch">
      <div class="card border-0 bg-light rounded shadow">
        <div class="card-body p-4 d-flex flex-column">
          <div>
            <div class="mt-3 card-text d-flex justify-content-between">
              <h5>{{book?.title}}</h5>
              <p>{{book?.language}}</p>
            </div>

            <p class="book-desc">Жанр: {{book?.genre?.name}}</p>
            <div class="book-desc">
              <span>Авторы: </span>
              <span *ngFor="let author of book?.authors; let i = index">
                  <span *ngIf="i===0">{{author.name}}</span>
                  <span *ngIf="i!==0">, {{author.name}}</span>
                </span>
            </div>

            <p class="book-desc" *ngIf="book?.person">Читатель: {{book?.person?.email}}</p>
          </div>

          <div class="mb-0 card-text d-flex mt-auto">
            <a *ngIf="!book?.person" (click)="onOpenModal(book, 'edit')" class="btn btn-primary ml-0 mr-auto">Читать</a>
            <a *ngIf="book?.person" (click)="onOpenModal(book, '-edit')" class="btn btn-primary ml-0 mr-auto">Вернуть</a>
            <a (click)="onOpenModal(book, 'delete')" class="btn btn-primary ml-auto mr-0"><i
              class="	fa fa-trash"></i></a>
          </div>
        </div>
      </div><!--end col-->
    </div><!--end row-->
  </div>


  <!-- Add Book Modal -->
  <div class="modal fade" id="addBookModal" tabindex="-1" role="dialog" aria-labelledby="addBookModalLabel"
       aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addBookModalLabel">Добавление новой книги</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form #addForm="ngForm" (ngSubmit)="onAddBook(addForm)">
            <div class="form-group">
              <label for="title">Название книги</label>
              <input type="text" ngModel name="title" class="form-control" id="title" placeholder="Название" required>
            </div>
            <div class="form-group">
              <label for="language">Язык текста</label>
              <input type="text" ngModel name="language" class="form-control" id="language" placeholder="рус бел и т.д."
                     required>
            </div>
            <div class="form-group">
              <label>Жанр</label>

              <div class="dropdown d-flex justify-content-between">
                <select class="form-select" name="genre" required ngModel>
                  <option disabled>Жанр</option>
                  <option *ngFor="let genre of genres" [ngValue]="genre">{{genre.name}}</option>
                </select>
              </div>

            </div>

            <div class="form-group">
              <label>Авторы</label>
              <div class="row" id="add-authors">
                <div class="dropdown d-flex justify-content-between mb-3">
                  <select size="3" class="form-select mr-1" name="authors" required multiple ngModel>
                    <option *ngFor="let author of authors" [ngValue]="author">{{author.name}}</option>
                  </select>
                </div>
              </div>

            </div>

            <div class="modal-footer">
              <button type="button" id="add-book-form" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть
              </button>
              <button type="submit" class="btn btn-primary">Сохранить</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>


  <!-- Delete Book Modal -->
  <div class="modal fade" id="deleteBookModal" tabindex="-1" role="dialog" aria-labelledby="deleteModelLabel"
       aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteModelLabel">Удаление книги</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Точно хотите удалить книгу "{{deleteBook?.title}}"?</p>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Нет</button>
            <button (click)="onDeleteBook(deleteBook?.id)" class="btn btn-danger" data-bs-dismiss="modal">Да</button>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Return from reader Book Modal -->
  <div class="modal fade" id="-editBookModal" tabindex="-1" role="dialog" aria-labelledby="-editModelLabel"
       aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="-editModelLabel">Возврат от {{editBook2?.person?.email}}</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Точно хотите вернуть книгу "{{editBook2?.title}}"?</p>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Нет</button>
            <button (click)="onUpdateBook(editBook2?.id!, 0)" class="btn btn-danger" data-bs-dismiss="modal">Да</button>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Set Reader Book Modal -->
  <div class="modal fade" id="editBookModal" tabindex="-1" role="dialog" aria-labelledby="setReaderModelLabel"
       aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="setReaderModelLabel">Читатель книги "{{editBook?.title}}"</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <form #editForm="ngForm">
            <input type="hidden" ngModel="{{editBook?.title}}" name="title" class="form-control" id="title2">
            <input type="hidden" ngModel="{{editBook?.id}}" name="id" class="form-control" id="id">
            <input type="hidden" ngModel="{{editBook?.language}}" name="language" class="form-control" id="language2">
            <input type="hidden" ngModel="{{editBook?.genre}}" name="genre" class="form-control" id="genre2">
            <input type="hidden" ngModel="{{editBook?.authors}}" name="authors" class="form-control" id="authors">
            <div class="form-group dropdown d-flex justify-content-between">
              <select class="form-select" name="person" id="person" required ngModel>
                <option *ngFor="let person of people" [ngValue]="person">{{person.email}}</option>
              </select>
            </div>
            <div class="modal-footer">
              <button type="button" id="" data-bs-dismiss="modal" class="btn btn-secondary">Закрыть</button>
              <button (click)="onUpdateBook(editForm.value.id, editForm.value?.person?.id!)" data-bs-dismiss="modal" class="btn btn-primary">Сохранить
              </button>
            </div>
          </form>
        </div>

      </div>
    </div>
  </div>


</div>
